"use strict";(()=>{var b="idle",r=null,i=null,c=null,f=0,e={step1Indicator:document.getElementById("step1-indicator"),step1Label:document.getElementById("step1-label"),step2Indicator:document.getElementById("step2-indicator"),step2Label:document.getElementById("step2-label"),step3Indicator:document.getElementById("step3-indicator"),step3Label:document.getElementById("step3-label"),step1:document.getElementById("step1"),step2:document.getElementById("step2"),step3:document.getElementById("step3"),loading:document.getElementById("loading"),loadingText:document.getElementById("loading-text"),dropZone:document.getElementById("drop-zone"),fileInput:document.getElementById("file-input"),fileName:document.getElementById("file-name"),password:document.getElementById("password"),decryptBtn:document.getElementById("decrypt-btn"),errorMessage:document.getElementById("error-message"),threadUrl:document.getElementById("thread-url"),step2Error:document.getElementById("step2-error"),backBtn:document.getElementById("back-btn"),startBtn:document.getElementById("start-btn"),currentUrl:document.getElementById("current-url"),uptime:document.getElementById("uptime"),stopBtn:document.getElementById("stop-btn")};function B(t){let s=Math.floor(t/1e3),n=Math.floor(s/3600),a=Math.floor(s%3600/60),d=s%60;return[n,a,d].map(I=>I.toString().padStart(2,"0")).join(":")}function p(t,s){t.textContent=s,t.classList.remove("hidden")}function u(t){t.classList.add("hidden")}function l(t){e.loadingText.textContent=t,e.loading.classList.remove("hidden"),e.step1.classList.add("hidden"),e.step2.classList.add("hidden"),e.step3.classList.add("hidden")}function M(){e.loading.classList.add("hidden")}function T(t){[{indicator:e.step1Indicator,label:e.step1Label},{indicator:e.step2Indicator,label:e.step2Label},{indicator:e.step3Indicator,label:e.step3Label}].forEach((n,a)=>{let d=a+1;n.indicator.classList.remove("active","completed","pending"),n.label.classList.remove("text-gray-700","text-gray-500","font-medium"),d<t?(n.indicator.classList.add("completed"),n.indicator.textContent="\u2713",n.label.classList.add("text-gray-500")):d===t?(n.indicator.classList.add("active"),n.indicator.textContent=d.toString(),n.label.classList.add("text-gray-700","font-medium")):(n.indicator.classList.add("pending"),n.indicator.textContent=d.toString(),n.label.classList.add("text-gray-500"))})}function o(t){M(),e.step1.classList.add("hidden"),e.step2.classList.add("hidden"),e.step3.classList.add("hidden"),t===1?e.step1.classList.remove("hidden"):t===2?e.step2.classList.remove("hidden"):t===3&&e.step3.classList.remove("hidden"),T(t)}function m(){let t=location.protocol==="https:"?"wss:":"ws:";i=new WebSocket(t+"//"+location.host+"/ws/status"),i.onopen=()=>{console.log("WebSocket connected")},i.onmessage=s=>{let n=JSON.parse(s.data);n.type==="status"&&v(n.data)},i.onclose=()=>{console.log("WebSocket disconnected, reconnecting in 3s..."),setTimeout(m,3e3)},i.onerror=s=>{console.error("WebSocket error:",s),i?.close()}}function v(t){b=t.state,t.state==="idle"?(o(1),g()):t.state==="ready"?(o(2),g()):t.state==="starting"?l("\u30AA\u30FC\u30D0\u30FC\u30EC\u30A4\u3092\u8D77\u52D5\u4E2D..."):t.state==="running"?(o(3),e.currentUrl.textContent=t.threadUrl??"",S()):t.state==="stopping"&&l("\u30AA\u30FC\u30D0\u30FC\u30EC\u30A4\u3092\u505C\u6B62\u4E2D...")}function S(){f=Date.now(),L(),c=setInterval(L,1e3)}function g(){c&&(clearInterval(c),c=null)}function L(){let t=Date.now()-f;e.uptime.textContent=B(t)}async function y(){if(!(!r||!e.password.value)){l("\u5FA9\u53F7\u5316\u4E2D..."),u(e.errorMessage);try{let t=new FormData;t.append("file",r),t.append("password",e.password.value);let n=await(await fetch("/api/decrypt",{method:"POST",body:t})).json();if(n.success)o(2);else{o(1);let a=n.error??"\u5FA9\u53F7\u5316\u306B\u5931\u6557\u3057\u307E\u3057\u305F";p(e.errorMessage,`${a}\u3002\u30D1\u30B9\u30EF\u30FC\u30C9\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\u3002`)}}catch{o(1),p(e.errorMessage,"\u30CD\u30C3\u30C8\u30EF\u30FC\u30AF\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F\u3002\u63A5\u7D9A\u3092\u78BA\u8A8D\u3057\u3066\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044\u3002")}}}async function h(){let t=e.threadUrl.value.trim();if(t){l("\u30AA\u30FC\u30D0\u30FC\u30EC\u30A4\u3092\u8D77\u52D5\u4E2D..."),u(e.step2Error);try{let n=await(await fetch("/api/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({threadUrl:t})})).json();if(!n.success){o(2);let a=n.error??"\u8D77\u52D5\u306B\u5931\u6557\u3057\u307E\u3057\u305F";p(e.step2Error,`${a}\u3002URL\u3092\u78BA\u8A8D\u3057\u3066\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044\u3002`)}}catch{o(2),p(e.step2Error,"\u30CD\u30C3\u30C8\u30EF\u30FC\u30AF\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F\u3002\u63A5\u7D9A\u3092\u78BA\u8A8D\u3057\u3066\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044\u3002")}}}async function H(){l("\u30AA\u30FC\u30D0\u30FC\u30EC\u30A4\u3092\u505C\u6B62\u4E2D...");try{await fetch("/api/stop",{method:"POST"})}catch(t){console.error("Stop error:",t),o(1)}}function E(){let t=r!==null&&e.password.value.length>0;e.decryptBtn.disabled=!t}function w(){let s=/^https:\/\/[\w-]+\.slack\.com\/archives\/[A-Z0-9]+\/p\d+$/.test(e.threadUrl.value.trim());e.startBtn.disabled=!s}e.dropZone.addEventListener("click",()=>e.fileInput.click());e.dropZone.addEventListener("dragover",t=>{t.preventDefault(),e.dropZone.classList.add("dragover")});e.dropZone.addEventListener("dragleave",()=>{e.dropZone.classList.remove("dragover")});e.dropZone.addEventListener("drop",t=>{t.preventDefault(),e.dropZone.classList.remove("dragover");let s=t.dataTransfer?.files;s&&s.length>0&&(r=s[0],e.fileName.textContent=r.name,E())});e.fileInput.addEventListener("change",()=>{e.fileInput.files&&e.fileInput.files.length>0&&(r=e.fileInput.files[0],e.fileName.textContent=r.name,E())});e.password.addEventListener("input",E);e.password.addEventListener("keypress",t=>{t.key==="Enter"&&!e.decryptBtn.disabled&&y()});e.decryptBtn.addEventListener("click",y);e.threadUrl.addEventListener("input",()=>{w(),u(e.step2Error)});e.threadUrl.addEventListener("keypress",t=>{t.key==="Enter"&&!e.startBtn.disabled&&h()});e.backBtn.addEventListener("click",()=>o(1));e.startBtn.addEventListener("click",h);e.stopBtn.addEventListener("click",H);fetch("/api/status").then(t=>t.json()).then(t=>{v(t),m()}).catch(t=>{console.error("Failed to fetch initial status:",t),o(1),m()});})();
//# sourceMappingURL=app.js.map
